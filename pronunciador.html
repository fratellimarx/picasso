

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pronunciador - Voces Reales</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4.1.7"></script>
    <script src="https://unpkg.com/@babel/standalone@7.26.10/babel.min.js"></script>
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.3.1",
            "react/": "https://esm.sh/react@18.3.1/",
            "react-dom/client": "https://esm.sh/react-dom@18.3.1/client",
            "lucide-react": "https://esm.sh/lucide-react@0.474.0?external=react"
        }
    }
    </script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel" data-type="module" data-presets="react">
        import React, { useState, useRef, useEffect, useMemo } from 'react';
        import { createRoot } from 'react-dom/client';
        import { Volume2, Play, Pause, ExternalLink, Globe, Sliders, User, UserCheck } from 'lucide-react';

        function App() {
            const [word, setWord] = useState('');
            const [language, setLanguage] = useState('en');
            const [gender, setGender] = useState('female');
            const [isPlaying, setIsPlaying] = useState(false);
            const [speed, setSpeed] = useState(1);
            const [pitch, setPitch] = useState(1);
            const [availableVoices, setAvailableVoices] = useState([]);
            const [selectedVoiceURI, setSelectedVoiceURI] = useState('');
            const synthRef = useRef(window.speechSynthesis || null);

            const languages = [
                { code: 'en', name: 'English', flag: 'ðŸ‡¬ðŸ‡§', langCode: 'en' },
                { code: 'es', name: 'EspaÃ±ol', flag: 'ðŸ‡ªðŸ‡¸', langCode: 'es' },
                { code: 'fr', name: 'FranÃ§ais', flag: 'ðŸ‡«ðŸ‡·', langCode: 'fr' },
                { code: 'de', name: 'Deutsch', flag: 'ðŸ‡©ðŸ‡ª', langCode: 'de' },
                { code: 'it', name: 'Italiano', flag: 'ðŸ‡®ðŸ‡¹', langCode: 'it' },
                { code: 'pt', name: 'PortuguÃªs', flag: 'ðŸ‡µðŸ‡¹', langCode: 'pt' },
                { code: 'ja', name: 'æ—¥æœ¬èªž', flag: 'ðŸ‡¯ðŸ‡µ', langCode: 'ja' },
                { code: 'ko', name: 'í•œêµ­ì–´', flag: 'ðŸ‡°ðŸ‡·', langCode: 'ko' },
                { code: 'zh', name: 'ä¸­æ–‡', flag: 'ðŸ‡¨ðŸ‡³', langCode: 'zh' },
                { code: 'ru', name: 'Ð ÑƒÑÑÐºÐ¸Ð¹', flag: 'ðŸ‡·ðŸ‡º', langCode: 'ru' },
            ];

            // Cargar voces del sistema
            const loadVoices = () => {
                const voices = window.speechSynthesis.getVoices();
                setAvailableVoices(voices);
            };

            useEffect(() => {
                loadVoices();
                if (window.speechSynthesis.onvoiceschanged !== undefined) {
                    window.speechSynthesis.onvoiceschanged = loadVoices;
                }
            }, []);

            // Filtrar voces por idioma actual
            const currentLangVoices = useMemo(() => {
                const lang = languages.find(l => l.code === language);
                return availableVoices.filter(v => v.lang.startsWith(lang.langCode));
            }, [availableVoices, language]);

            // Intentar detectar si una voz es hombre o mujer por su nombre
            const isMaleVoice = (name) => {
                const n = name.toLowerCase();
                return n.includes('male') || n.includes('man') || n.includes('david') || 
                       n.includes('mark') || n.includes('daniel') || n.includes('pablo') || 
                       n.includes('stefan') || n.includes('paul') || n.includes('james') ||
                       n.includes('thomas') || n.includes('marcus');
            };

            // Seleccionar automÃ¡ticamente la mejor voz cuando cambia el gÃ©nero o el idioma
            useEffect(() => {
                const voicesByGender = currentLangVoices.filter(v => 
                    gender === 'male' ? isMaleVoice(v.name) : !isMaleVoice(v.name)
                );
                
                if (voicesByGender.length > 0) {
                    setSelectedVoiceURI(voicesByGender[0].voiceURI);
                } else if (currentLangVoices.length > 0) {
                    setSelectedVoiceURI(currentLangVoices[0].voiceURI);
                }
            }, [currentLangVoices, gender]);

            const speak = () => {
                if (!word.trim()) return;

                if (synthRef.current.speaking) {
                    synthRef.current.cancel();
                    setIsPlaying(false);
                    return;
                }

                const voice = availableVoices.find(v => v.voiceURI === selectedVoiceURI);
                const utterance = new SpeechSynthesisUtterance(word);
                
                const selectedLang = languages.find(l => l.code === language);
                utterance.lang = voice ? voice.lang : selectedLang.langCode;
                if (voice) utterance.voice = voice;
                
                utterance.rate = speed;
                utterance.pitch = pitch;

                utterance.onstart = () => setIsPlaying(true);
                utterance.onend = () => setIsPlaying(false);
                utterance.onerror = () => setIsPlaying(false);

                synthRef.current.speak(utterance);
            };

            const getSources = (w) => {
                const encoded = encodeURIComponent(w);
                return [
                    { name: 'Forvo', icon: 'ðŸŽ¤', url: `https://forvo.com/search/${encoded}/${language}/` },
                    { name: 'Google', icon: 'ðŸ”¤', url: `https://translate.google.com/?sl=${language}&text=${encoded}` },
                ];
            };

            return (
                <div className="min-h-screen bg-slate-50 p-4 md:p-8 font-sans">
                    <div className="max-w-3xl mx-auto">
                        <header className="text-center mb-8">
                            <div className="flex justify-center mb-2"><Volume2 className="w-12 h-12 text-indigo-600" /></div>
                            <h1 className="text-3xl font-extrabold text-slate-800">Pronunciador Inteligente</h1>
                            <p className="text-slate-500">Ajusta la voz y escucha la diferencia</p>
                        </header>

                        <div className="bg-white rounded-2xl shadow-xl border border-slate-200 overflow-hidden">
                            {/* Idioma */}
                            <div className="p-6 border-b border-slate-100 bg-slate-50/50">
                                <div className="flex items-center gap-2 mb-4 text-sm font-bold text-slate-700 uppercase tracking-wider">
                                    <Globe className="w-4 h-4" /> Selecciona Idioma
                                </div>
                                <div className="grid grid-cols-5 gap-2">
                                    {languages.map(l => (
                                        <button 
                                            key={l.code}
                                            onClick={() => setLanguage(l.code)}
                                            className={`py-2 rounded-lg text-sm font-medium transition-all ${language === l.code ? 'bg-indigo-600 text-white shadow-lg scale-105' : 'bg-white border border-slate-200 text-slate-600 hover:border-indigo-300'}`}
                                        >
                                            <span className="mr-1">{l.flag}</span> {l.name}
                                        </button>
                                    ))}
                                </div>
                            </div>

                            <div className="p-6 md:p-8 space-y-8">
                                {/* Entrada */}
                                <div>
                                    <input 
                                        type="text" 
                                        value={word} 
                                        onChange={(e) => setWord(e.target.value)}
                                        onKeyPress={(e) => e.key === 'Enter' && speak()}
                                        placeholder="Escribe aquÃ­ (ej: 'Hello world')"
                                        className="w-full text-2xl font-semibold p-4 rounded-xl border-2 border-slate-200 focus:border-indigo-500 focus:ring-4 focus:ring-indigo-50 transition-all outline-none"
                                    />
                                </div>

                                {/* GÃ©nero y Voz EspecÃ­fica */}
                                <div className="grid md:grid-cols-2 gap-6">
                                    <div>
                                        <label className="block text-sm font-bold text-slate-700 mb-3 uppercase tracking-tighter">Estilo de Voz</label>
                                        <div className="flex gap-2">
                                            <button 
                                                onClick={() => setGender('female')}
                                                className={`flex-1 flex items-center justify-center gap-2 py-3 rounded-xl font-bold transition-all ${gender === 'female' ? 'bg-indigo-600 text-white shadow-md' : 'bg-slate-100 text-slate-500 hover:bg-slate-200'}`}
                                            >
                                                <User className="w-4 h-4" /> Mujer
                                            </button>
                                            <button 
                                                onClick={() => setGender('male')}
                                                className={`flex-1 flex items-center justify-center gap-2 py-3 rounded-xl font-bold transition-all ${gender === 'male' ? 'bg-indigo-600 text-white shadow-md' : 'bg-slate-100 text-slate-500 hover:bg-slate-200'}`}
                                            >
                                                <UserCheck className="w-4 h-4" /> Hombre
                                            </button>
                                        </div>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-bold text-slate-700 mb-3 uppercase tracking-tighter">Voz del Sistema</label>
                                        <select 
                                            value={selectedVoiceURI}
                                            onChange={(e) => setSelectedVoiceURI(e.target.value)}
                                            className="w-full p-3 rounded-xl border border-slate-200 bg-slate-50 text-sm outline-none focus:border-indigo-500"
                                        >
                                            {currentLangVoices.length > 0 ? (
                                                currentLangVoices.map(v => (
                                                    <option key={v.voiceURI} value={v.voiceURI}>{v.name}</option>
                                                ))
                                            ) : (
                                                <option>No se detectan voces...</option>
                                            )}
                                        </select>
                                    </div>
                                </div>

                                {/* Sliders de Control */}
                                <div className="grid md:grid-cols-2 gap-8 bg-slate-50 p-6 rounded-2xl">
                                    <div className="space-y-4">
                                        <div className="flex justify-between text-sm font-bold text-slate-600">
                                            <span className="flex items-center gap-2"><Sliders className="w-4 h-4" /> Velocidad</span>
                                            <span className="text-indigo-600">{speed}x</span>
                                        </div>
                                        <input 
                                            type="range" min="0.5" max="2" step="0.1" value={speed} 
                                            onChange={(e) => setSpeed(parseFloat(e.target.value))}
                                            className="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-indigo-600"
                                        />
                                    </div>
                                    <div className="space-y-4">
                                        <div className="flex justify-between text-sm font-bold text-slate-600">
                                            <span className="flex items-center gap-2"><Volume2 className="w-4 h-4" /> Tono</span>
                                            <span className="text-indigo-600">{pitch}x</span>
                                        </div>
                                        <input 
                                            type="range" min="0.5" max="2" step="0.1" value={pitch} 
                                            onChange={(e) => setPitch(parseFloat(e.target.value))}
                                            className="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-indigo-600"
                                        />
                                    </div>
                                </div>

                                {/* BotÃ³n Play */}
                                <button 
                                    onClick={speak}
                                    disabled={!word.trim()}
                                    className={`w-full py-5 rounded-2xl font-black text-xl flex items-center justify-center gap-4 transition-all ${isPlaying ? 'bg-red-500 text-white' : 'bg-indigo-600 text-white hover:bg-indigo-700 hover:shadow-2xl hover:-translate-y-1 active:scale-95 disabled:opacity-30 disabled:translate-y-0 disabled:shadow-none'}`}
                                >
                                    {isPlaying ? <><Pause className="w-8 h-8 fill-current" /> DETENER</> : <><Play className="w-8 h-8 fill-current" /> REPRODUCIR</>}
                                </button>
                            </div>
                        </div>

                        {/* Fuentes Externas */}
                        {word.trim() && (
                            <div className="mt-8 flex justify-center gap-4">
                                {getSources(word).map(s => (
                                    <a key={s.name} href={s.url} target="_blank" className="flex items-center gap-2 px-4 py-2 bg-white rounded-full border border-slate-200 text-slate-600 text-sm font-bold hover:bg-slate-50 transition-colors">
                                        {s.icon} Ver en {s.name} <ExternalLink className="w-3 h-3" />
                                    </a>
                                ))}
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>


